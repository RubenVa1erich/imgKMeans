@startuml
actor "User" as user
participant "ImgKMeans" as app
entity "Apigateaway" as api
box "back" #LightBlue
participant "Сервис регистрации" as auth
database "База данных" as db

autonumber

user -> app++: ввод данных для регистрации
app -> app: проверка введенных данных

opt введенные пользователем данные некорректны
app --> user--: сообщение об ошибке
end

app -> api++: вызов сервиса регистрации
api -> auth++: вызов сервиса регистрации

opt введенные пользователем данные некорректны
auth --> api--: данные некорректны
api --> app--: сообщение об ошибке
app --> user--: сообщение об ошибке
end

auth -> db: проверка дублирования данных 

alt пользователь с такими данными уже зарегистрирован
db --> auth--: пользователь с указанными данными уже зарегистрирован
auth --> api--: результат проверки
api --> app--: результат проверки
app --> user--: сообщение об ошибке

else данные не зарегистрированы в системе
db --> auth--: пользователь с указанными данными не зарегистрирован
auth -> db++: создание новой записи в БД
db --> auth--: запись успешно создана
auth --> api--: запись успешно создана
api --> app--: запись успешно создана
app --> user--: запись успешно создана
end
@enduml
